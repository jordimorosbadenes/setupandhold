---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { entry: post },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const { title, description, date, updated, tags, hero } = entry.data;
const published = new Date(date).toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
const updatedAt = updated
  ? new Date(updated).toLocaleDateString('es-ES', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    })
  : null;
---
<BaseLayout title={`${title} | setupandhold`} description={description}>
  <article class="hero prose">
    <div class="card-meta">
      <span class="pill">Publicado {published}</span>
      {updatedAt && <span class="pill">Actualizado {updatedAt}</span>}
    </div>
    <h1>{title}</h1>
    <p>{description}</p>
    {tags?.length ? (
      <div class="tag-row">
        {tags.map((tag) => (
          <a class="tag" href={`/tags/${tag.toLowerCase()}`}>{tag}</a>
        ))}
      </div>
    ) : null}
    {hero ? (
      <figure style="margin: 0;">
        <img
          src={hero.src}
          alt={hero.alt || title}
          style="width: 100%; border-radius: var(--radius); border: 1px solid var(--border);"
          loading="lazy"
        />
      </figure>
    ) : null}
    <Content />
  </article>
</BaseLayout>
